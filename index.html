<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gloria's Cookhouse</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #fff;
    color: #333;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    background: #fff;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  header a {
    text-decoration: none;
    color: #B95E30;
    font-weight: bold;
  }
  h1, h2 {
    color: #B95E30;
    text-align: center;
  }
  p.note {
    text-align: center;
    font-style: italic;
    margin: 15px auto;
    max-width: 95%;
  }
  .buttons a {
    display: block;
    margin: 10px auto;
    padding: 12px 20px;
    background: #FFA500;
    color: #fff;
    text-decoration: none;
    border-radius: 8px;
    width: 220px;
    text-align: center;
  }
  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 15px;
    padding: 20px;
  }
  .gallery div {
    text-align: center;
    cursor: pointer;
  }
  .gallery img {
    width: 100%;
    border-radius: 10px;
    max-width: 180px;
  }
  .cart-icon {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background: #B95E30;
    color: #fff;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 22px;
    cursor: pointer;
    z-index: 200;
  }
  .cart-count {
    position: absolute;
    top: 6px;
    right: 8px;
    background: #FFD700;
    color: #000;
    border-radius: 50%;
    padding: 3px 7px;
    font-size: 12px;
  }
  button, input, select, textarea {
    font-family: inherit;
  }
  button {
    cursor: pointer;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 300;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    text-align: center;
  }
  .modal-content img {
    max-width: 200px;
    border-radius: 8px;
  }
  .modal-content input {
    width: 80%;
    padding: 8px;
    margin: 10px 0;
  }
  .modal-content button {
    background: #B95E30;
    color: #fff;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    margin: 5px;
  }
  .checkout-page {
    display: none;
    padding: 20px;
    max-width: 500px;
    margin: auto;
  }
  .checkout-page input, .checkout-page select, .checkout-page textarea {
    width: 100%;
    padding: 8px;
    margin: 8px 0;
  }
  .checkout-page button {
    display: block;
    margin: 15px auto;
    background: #B95E30;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
  }
  @media(max-width:600px){
    .gallery img{max-width:140px;}
    .cart-icon{width:55px;height:55px;}
  }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCVeu4VrXiqDnyM5EZjQfc3y94ZVBhSt-Y",
  authDomain: "gloria-s-cookhouse.firebaseapp.com",
  databaseURL: "https://gloria-s-cookhouse-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "gloria-s-cookhouse",
  storageBucket: "gloria-s-cookhouse.firebasestorage.app",
  messagingSenderId: "242537183123",
  appId: "1:242537183123:web:4cdbc739f2f62b2b789a66"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let cart = [];

function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById(id).style.display = "block";
  document.getElementById("cartIcon").style.display = (id === "menuPage") ? "flex" : "none";
}

document.addEventListener("DOMContentLoaded", () => {
  const lightbox = document.getElementById("lightbox");
  const lbImg = document.getElementById("lightboxImg");
  const lbTitle = document.getElementById("lightboxTitle");
  const qtyInput = document.getElementById("qty");
  let selectedItem = null;

  document.querySelectorAll(".gallery div").forEach(div => {
    div.addEventListener("click", () => {
      selectedItem = {
        name: div.querySelector("p").textContent,
        img: div.querySelector("img").src,
        price: parseInt(div.querySelector("p").textContent.match(/\d+/)[0])
      };
      lbImg.src = selectedItem.img;
      lbTitle.textContent = selectedItem.name;
      qtyInput.value = 1;
      lightbox.style.display = "flex";
    });
  });

  document.getElementById("addToCartBtn").addEventListener("click", () => {
    const qty = parseInt(qtyInput.value);
    const existing = cart.find(i => i.name === selectedItem.name);
    if (existing) existing.qty += qty;
    else cart.push({...selectedItem, qty});
    updateCartCount();
    lightbox.style.display = "none";
  });

  document.getElementById("closeLightbox").addEventListener("click", ()=>lightbox.style.display="none");
  document.getElementById("cartIcon").addEventListener("click", showCartModal);
  document.getElementById("checkoutBtn").addEventListener("click", ()=>{document.getElementById("cartModal").style.display="none";showPage("checkoutPage")});
  document.getElementById("cancelCartBtn").addEventListener("click", ()=>document.getElementById("cartModal").style.display="none");

  document.getElementById("orderForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    const total = calculateTotal(data.method);
    await push(ref(db, "orders"), {cart, data, total, timestamp: new Date().toISOString()});
    cart = [];
    updateCartCount();
    e.target.reset();
    showModal();
  });

  document.getElementById("method").addEventListener("change", e=>{
    document.getElementById("addressField").style.display = e.target.value==="Delivery" ? "block" : "none";
  });

  document.getElementById("okModalBtn").addEventListener("click", ()=>{
    document.getElementById("orderModal").style.display="none";
    showPage("homePage");
  });
});

function showCartModal(){
  const modal = document.getElementById("cartModal");
  const list = document.getElementById("cartItems");
  list.innerHTML = "";
  cart.forEach((item,i)=>{
    const li = document.createElement("li");
    li.innerHTML = `
      ${item.name} - ${item.qty} x ${item.price} DKK = ${item.qty*item.price} DKK 
      <button onclick="changeQty(${i},1)">+</button>
      <button onclick="changeQty(${i},-1)">-</button>
      <button onclick="removeItem(${i})">Remove</button>`;
    list.appendChild(li);
  });
  document.getElementById("cartTotal").textContent = "Total: "+calculateTotal()+" DKK";
  modal.style.display = "flex";
}

window.changeQty=(i,delta)=>{
  cart[i].qty+=delta;
  if(cart[i].qty<=0) removeItem(i);
  updateCartCount();
  showCartModal();
};

window.removeItem=(i)=>{
  cart.splice(i,1);
  updateCartCount();
  showCartModal();
};

function calculateTotal(method){
  let sum = cart.reduce((a,c)=>a+c.price*c.qty,0);
  if(method==="Pickup") sum*=0.9;
  return Math.round(sum);
}
function updateCartCount(){
  document.getElementById("cartCount").textContent = cart.reduce((a,c)=>a+c.qty,0);
}
function showModal(){
  document.getElementById("orderModal").style.display="flex";
}
</script>
</head>
<body>
  <!-- Home -->
  <div id="homePage" class="page">
    <header><a href="#" onclick="showPage('checkoutPage')">Contact Us</a></header>
    <h1>Gloria's Cookhouse</h1>
    <p style="text-align:center;">Soul Food Fusion<br>Crafted with Love; A Global Village Kitchen, Where Africa Meets the World.</p>
    <div class="buttons">
      <a href="#" onclick="showPage('menuPage')">See Menu</a>
    </div>
  </div>

  <!-- Menu -->
  <div id="menuPage" class="page" style="display:none;">
    <h1>Our Menu (Bestsellers)</h1>
    <p class="note">Pre-order window: Customers may place orders from 10 a.m. to 6 p.m. the previous day.<br>Collection window: Orders ready 5â€“8 p.m. daily.<br>This allows proper planning and fresh ingredients.<br>Halal food, 650g portions, and catering available (min 1 week notice).<br>The minimum order is 299 DKK.</p>
    <div class="gallery">
      <div><img src="food6.jpg"><p>Signature African Jollof Rice - 179 DKK</p></div>
      <div><img src="food9.jpg"><p>Mixed Veggies Fried Rice - 179 DKK</p></div>
      <div><img src="food22.jpg"><p>Garden Stir Fry Rice & Chicken - 179 DKK</p></div>
      <div><img src="food16.jpg"><p>Egusi Soup with Fufu - 249 DKK</p></div>
      <div><img src="food7.jpg"><p>Efo Riro Soup with Fufu - 249 DKK</p></div>
      <div><img src="food11.jpg"><p>Meatpie/Chicken Pie (pair) - 139 DKK</p></div>
      <div><img src="food3.jpg"><p>Moi Moi with Fried Plantains - 199 DKK</p></div>
      <div><img src="food21.jpg"><p>Banana Bread Minis (Pack) - 99 DKK</p></div>
      <div><img src="food23.jpg"><p>Grilled Chicken (6 drumsticks) - 149 DKK</p></div>
      <div><img src="food4.jpg"><p>Beef Kebabs - 149 DKK</p></div>
    </div>
    <div id="cartIcon" class="cart-icon">ðŸ›’<span id="cartCount" class="cart-count">0</span></div>
    <button style="display:block;margin:20px auto;" onclick="showPage('homePage')">Back</button>
  </div>

  <!-- Checkout -->
  <div id="checkoutPage" class="page checkout-page">
    <h2>Checkout</h2>
    <form id="orderForm">
      <input name="name" placeholder="Full Name" required>
      <input name="phone" placeholder="Phone Number" required>
      <select name="method" id="method" required>
        <option value="">Select Method</option>
        <option>Pickup</option>
        <option>Delivery</option>
      </select>
      <div id="addressField" style="display:none;"><input name="address" placeholder="Delivery Address"></div>
      <p style="font-size:0.9em;color:#B95E30;">Note: Delivery is only available for bulk orders from and over 5000 DKK.</p>
      <input type="date" name="date" required>
      <input type="time" name="time" required>
      <textarea name="note" placeholder="Additional notes"></textarea>
      <button type="submit">Confirm Order</button>
      <button type="button" onclick="showPage('menuPage')">Cancel</button>
    </form>
    <p style="text-align:center;margin-top:10px;">Pay via MobilePay: <strong>+45 91 67 30 68</strong></p>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="modal">
    <div class="modal-content">
      <img id="lightboxImg" src="">
      <h3 id="lightboxTitle"></h3>
      <p>Quantity:</p>
      <input type="number" id="qty" min="1" value="1">
      <div>
        <button id="addToCartBtn">Add to Cart</button>
        <button id="closeLightbox">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Cart Modal -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <h3>Your Cart</h3>
      <ul id="cartItems" style="text-align:left;list-style:none;padding:0;"></ul>
      <p id="cartTotal"></p>
      <button id="checkoutBtn">Checkout</button>
      <button id="cancelCartBtn">Cancel</button>
    </div>
  </div>

  <!-- Order Confirmation -->
  <div id="orderModal" class="modal">
    <div class="modal-content">
      <p>Your order has been placed! Kindly call <strong>+45 91 67 30 68</strong> if you have any questions regarding address or food.</p>
      <button id="okModalBtn">OK</button>
    </div>
  </div>
</body>
</html>
